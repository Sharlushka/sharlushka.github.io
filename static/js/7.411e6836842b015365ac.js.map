{"version":3,"sources":["webpack:///static/js/7.411e6836842b015365ac.js","webpack:///./src/components/EndGame.vue","webpack:///src/components/EndGame.vue","webpack:///./src/components/EndGame.vue?dbb5"],"names":["webpackJsonp","/rXD","module","__webpack_exports__","__webpack_require__","injectStyle","ssrContext","Object","defineProperty","value","helpers_extends","extends_default","n","vuex_esm","store","CloseBtn","firebaseInit","EndGame","data","message","messageText","graduationMessage","schoolScoreMessage","userName","highestScore","hiscoreGreeting","exclamation","lastScores","schoolScores","components","closeBtn","computed","mounted","this","$nextTick","console","log","getUserData","isAuthenticated","name","getDefaultUserName","getCurrentGameState","gameInProgress","localStorage","getItem","getTotalScore","setItem","addScoreToDatabase","state","methods","restartGame","commit","$router","push","split","schoolCompleted","getSchoolScore","syncScoreInFirebase","uid","collection","where","get","then","querySnapshot","docToUpdateId","forEach","doc","id","docRef","resultsArrayToUpdate","highestScoreToUpdate","schoolScoresToUpdate","updateDocRef","update","resultsArray","schoolResultsArray","hiScore","catch","error","render","_vm","_h","$createElement","_c","_self","attrs","_v","align-center","justify-center","row","fill-height","wrap","staticClass","xs12","_s","_e","justify-space-around","d-flex","xs5","lg2","ripple","large","color","on","click","medium","to","staticRenderFns","esExports","components_EndGame","normalizeComponent","__vue_styles__","Component","LDES","exports"],"mappings":"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","file":"static/js/7.411e6836842b015365ac.js","sourcesContent":["webpackJsonp([7],{\n\n/***/ \"/rXD\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n\n// EXTERNAL MODULE: ./node_modules/babel-runtime/helpers/extends.js\nvar helpers_extends = __webpack_require__(\"Dd8w\");\nvar extends_default = /*#__PURE__*/__webpack_require__.n(helpers_extends);\n\n// EXTERNAL MODULE: ./node_modules/vuex/dist/vuex.esm.js\nvar vuex_esm = __webpack_require__(\"NYxO\");\n\n// EXTERNAL MODULE: ./src/store/store.js + 3 modules\nvar store = __webpack_require__(\"wtEF\");\n\n// EXTERNAL MODULE: ./src/components/CloseBtn.vue + 2 modules\nvar CloseBtn = __webpack_require__(\"stGB\");\n\n// EXTERNAL MODULE: ./src/components/firebaseInit.js\nvar firebaseInit = __webpack_require__(\"qVsQ\");\n\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/EndGame.vue\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n\n\n\n\n/* harmony default export */ var EndGame = ({\n  data: function data() {\n    return {\n      message: 'Game over,',\n      messageText: 'Your score is',\n      graduationMessage: 'You can\\'t even finish the school.',\n      schoolScoreMessage: 'Your score is',\n      userName: '',\n      highestScore: null,\n      hiscoreGreeting: 'Your highest score is',\n      exclamation: '!', // some over-engeneering\n      lastScores: [],\n      schoolScores: []\n    };\n  },\n\n  components: {\n    closeBtn: CloseBtn[\"a\" /* default */]\n  },\n  computed: extends_default()({}, Object(vuex_esm[\"c\" /* mapGetters */])(['getTotalScore', 'getSchoolScore', 'getCurrentGameState', 'getDefaultUserName', 'getUserData'])),\n  mounted: function mounted() {\n    this.$nextTick(function () {\n      console.log('Game over');\n      // check user status\n      if (this.getUserData.isAuthenticated) {\n        this.userName = this.getUserData.name;\n      } else {\n        this.userName = this.getDefaultUserName;\n      }\n      if (this.getCurrentGameState.gameInProgress) {\n        // collect them when mounted and game finished\n        if (localStorage.getItem('highestScore') === null) {\n          // check if localStorage set\n          console.log('No local storage score array yet exist, creating one');\n          this.lastScores = []; // initial values\n          this.schoolScores = [];\n          this.highestScore = this.getTotalScore; // first run\n          localStorage.setItem('lastScoresArray', this.lastScores);\n          localStorage.setItem('schoolScores', this.schoolScores);\n          localStorage.setItem('highestScore', this.getTotalScore);\n          // and\n          this.addScoreToDatabase();\n        } else {\n          this.lastScores = localStorage.getItem('lastScoresArray');\n          this.schoolScores = localStorage.getItem('schoolScores');\n          this.highestScore = localStorage.getItem('highestScore');\n          // just add it already\n          this.addScoreToDatabase();\n        }\n        // set to default state so repeating visits\n        // to this page won't fill our array with zeroes\n        store[\"a\" /* default */].state.gameInProgress = false; // mutation?\n      } else {\n        console.log('Nothing to record, play the game.');\n      }\n    });\n  },\n\n  methods: {\n    restartGame: function restartGame() {\n      console.log('Restarting game');\n      store[\"a\" /* default */].commit('resetState');\n      this.$router.push('/game');\n    },\n\n    // add anonymous score to local storage\n    addScoreToDatabase: function addScoreToDatabase() {\n      console.log('Adding score');\n      // one function?\n      if (this.lastScores === '') {\n        this.lastScores = []; // first run\n      } else {\n        this.lastScores = this.lastScores.split(',');\n      }\n      if (this.schoolScores === '') {\n        this.schoolScores = [];\n      } else {\n        this.schoolScores = this.schoolScores.split(',');\n      }\n      // check for new highest score\n      if (this.getTotalScore > this.highestScore) {\n        this.highestScore = this.getTotalScore;\n        localStorage.setItem('highestScore', this.getTotalScore);\n      } else {\n        console.log('Your score is not so high: ' + this.getTotalScore);\n      }\n\n      if (this.getCurrentGameState.schoolCompleted) {\n        // record game result if school completed\n        this.lastScores.push(this.getTotalScore);\n        localStorage.setItem('lastScoresArray', this.lastScores);\n        // and school result for stats\n        this.schoolScores.push(this.getSchoolScore);\n        localStorage.setItem('schoolScores', this.schoolScores);\n      } else {\n        // game ended in school,\n        // so we have only school result to save\n        this.schoolScores.push(this.getSchoolScore);\n        localStorage.setItem('schoolScores', this.schoolScores);\n      }\n      // finally if user is registered\n      if (this.getUserData.isAuthenticated) {\n        this.syncScoreInFirebase();\n      } else {\n        console.log('Anonymous! To save results please register.');\n      }\n    },\n\n    // if user exists add score to the account\n    syncScoreInFirebase: function syncScoreInFirebase() {\n      console.log('Syncing score for uid ' + this.getUserData.uid);\n      var uid = this.getUserData.uid;\n      firebaseInit[\"a\" /* default */].collection('users').where('uid', '==', uid).get().then(function (querySnapshot) {\n        var docToUpdateId = void 0;\n        querySnapshot.forEach(function (doc) {\n          // doc.data() is never undefined for query doc snapshots\n          if (doc.data().uid === uid) {\n            docToUpdateId = doc.id;\n          }\n        });\n        return docToUpdateId;\n      }).then(function (docToUpdateId) {\n        var docRef = firebaseInit[\"a\" /* default */].collection('users').doc(docToUpdateId);\n        var resultsArrayToUpdate = localStorage.getItem('lastScoresArray');\n        // you really should check if it is actually higher\n        var highestScoreToUpdate = localStorage.getItem('highestScore');\n        var schoolScoresToUpdate = localStorage.getItem('schoolScores');\n        var updateDocRef = docRef.update({\n          resultsArray: resultsArrayToUpdate,\n          schoolResultsArray: schoolScoresToUpdate,\n          hiScore: highestScoreToUpdate\n        });\n        console.log('...updating user stats');\n        return updateDocRef; // ? true\n      }).catch(function (error) {\n        console.log('Error getting documents: ', error);\n      });\n    }\n  }\n});\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2c9c3778\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/EndGame.vue\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',{attrs:{\"id\":\"endGame\"}},[_c('closeBtn'),_vm._v(\" \"),_c('v-layout',{attrs:{\"align-center\":\"\",\"justify-center\":\"\",\"row\":\"\",\"fill-height\":\"\",\"wrap\":\"\"}},[_c('v-flex',{staticClass:\"user-name-game-end text-xs-center\",attrs:{\"xs12\":\"\"}},[_c('h1',[_vm._v(_vm._s(_vm.message)),_c('br'),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.userName)+_vm._s(_vm.exclamation))])])]),_vm._v(\" \"),(!this.getCurrentGameState.schoolCompleted)?_c('v-flex',{staticClass:\"message-school text-xs-center\",attrs:{\"xs12\":\"\"}},[_c('h3',[_vm._v(_vm._s(_vm.graduationMessage))]),_vm._v(\" \"),_c('h2',[_vm._v(_vm._s(_vm.schoolScoreMessage)+\" \"+_vm._s(_vm.getTotalScore))])]):_vm._e(),_vm._v(\" \"),(this.getCurrentGameState.schoolCompleted)?_c('v-flex',{staticClass:\"message-game text-xs-center\",attrs:{\"xs12\":\"\"}},[_c('h2',[_vm._v(_vm._s(_vm.messageText)+\" \"+_vm._s(_vm.getTotalScore))])]):_vm._e(),_vm._v(\" \"),_c('v-layout',{attrs:{\"row\":\"\",\"align-center\":\"\",\"justify-space-around\":\"\"}},[_c('v-flex',{staticClass:\"text-xs-center\",attrs:{\"d-flex\":\"\",\"xs5\":\"\",\"lg2\":\"\"}},[_c('v-btn',{attrs:{\"ripple\":\"\",\"large\":\"\",\"color\":\"orange\"},on:{\"click\":_vm.restartGame}},[_c('v-icon',{attrs:{\"medium\":\"\",\"color\":\"white\"}},[_vm._v(\"replay\")])],1)],1),_vm._v(\" \"),_c('v-flex',{staticClass:\"text-xs-center\",attrs:{\"d-flex\":\"\",\"xs5\":\"\",\"lg2\":\"\"}},[_c('v-btn',{attrs:{\"ripple\":\"\",\"large\":\"\",\"color\":\"purple darken-1\",\"to\":'/settings'}},[_c('v-icon',{attrs:{\"medium\":\"\",\"color\":\"white\"}},[_vm._v(\"trending_up\")])],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\n/* harmony default export */ var components_EndGame = (esExports);\n// CONCATENATED MODULE: ./src/components/EndGame.vue\nfunction injectStyle (ssrContext) {\n  __webpack_require__(\"LDES\")\n}\nvar normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2c9c3778\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  EndGame,\n  components_EndGame,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var src_components_EndGame = __webpack_exports__[\"default\"] = (Component.exports);\n\n\n/***/ }),\n\n/***/ \"LDES\":\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/7.411e6836842b015365ac.js","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2c9c3778\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./EndGame.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./EndGame.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./EndGame.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2c9c3778\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./EndGame.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2c9c3778\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/EndGame.vue\n// module id = null\n// module chunks = ","<template>\r\n  <v-container id=\"endGame\">\r\n<!-- Close button -->\r\n    <closeBtn></closeBtn>\r\n    <v-layout align-center justify-center row fill-height wrap>\r\n<!-- Messages -->\r\n      <v-flex xs12 class=\"user-name-game-end text-xs-center\">\r\n        <h1 >{{ message }}<br />\r\n          <span>{{ userName }}{{ exclamation }}</span>\r\n        </h1>\r\n      </v-flex>\r\n<!-- School message -->\r\n      <v-flex xs12 class=\"message-school text-xs-center\"\r\n        v-if=\"!this.getCurrentGameState.schoolCompleted\">\r\n        <h3>{{ graduationMessage }}</h3>\r\n        <h2>{{ schoolScoreMessage }} {{ getTotalScore }}</h2>\r\n      </v-flex>\r\n<!-- Game message -->\r\n      <v-flex xs12 class=\"message-game text-xs-center\"\r\n        v-if=\"this.getCurrentGameState.schoolCompleted\">\r\n        <h2>{{ messageText }} {{ getTotalScore }}</h2>\r\n      </v-flex>\r\n<!-- Buttons -->\r\n      <v-layout row align-center justify-space-around>\r\n        <v-flex d-flex xs5 lg2 class=\"text-xs-center\">\r\n          <v-btn ripple\r\n            large color=\"orange\"\r\n            @click=\"restartGame\">\r\n            <v-icon medium color=\"white\">replay</v-icon>\r\n          </v-btn>\r\n        </v-flex>\r\n        <v-flex d-flex xs5 lg2 class=\"text-xs-center\">\r\n          <v-btn ripple\r\n            large color=\"purple darken-1\"\r\n            :to=\"'/settings'\">\r\n            <v-icon medium color=\"white\">trending_up</v-icon>\r\n          </v-btn>\r\n        </v-flex>\r\n      </v-layout>\r\n    </v-layout>\r\n  </v-container>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex'\r\nimport store from '../store/store'\r\nimport closeBtn from '../components/CloseBtn'\r\nimport db from './firebaseInit'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      message: 'Game over,',\r\n      messageText: 'Your score is',\r\n      graduationMessage: 'You can\\'t even finish the school.',\r\n      schoolScoreMessage: 'Your score is',\r\n      userName: '',\r\n      highestScore: null,\r\n      hiscoreGreeting: 'Your highest score is',\r\n      exclamation: '!', // some over-engeneering\r\n      lastScores: [],\r\n      schoolScores: []\r\n    }\r\n  },\r\n  components: {\r\n    closeBtn\r\n  },\r\n  computed: {\r\n    ...mapGetters([\r\n      'getTotalScore',\r\n      'getSchoolScore',\r\n      'getCurrentGameState',\r\n      'getDefaultUserName',\r\n      'getUserData'\r\n    ])\r\n  },\r\n  mounted () {\r\n    this.$nextTick(function () {\r\n      console.log(`Game over`)\r\n      // check user status\r\n      if (this.getUserData.isAuthenticated) {\r\n        this.userName = this.getUserData.name\r\n      } else {\r\n        this.userName = this.getDefaultUserName\r\n      }\r\n      if (this.getCurrentGameState.gameInProgress) {\r\n        // collect them when mounted and game finished\r\n        if (localStorage.getItem('highestScore') === null) { // check if localStorage set\r\n          console.log(`No local storage score array yet exist, creating one`)\r\n          this.lastScores = [] // initial values\r\n          this.schoolScores = []\r\n          this.highestScore = this.getTotalScore // first run\r\n          localStorage.setItem('lastScoresArray', this.lastScores)\r\n          localStorage.setItem('schoolScores', this.schoolScores)\r\n          localStorage.setItem('highestScore', this.getTotalScore)\r\n          // and\r\n          this.addScoreToDatabase()\r\n        } else {\r\n          this.lastScores = localStorage.getItem('lastScoresArray')\r\n          this.schoolScores = localStorage.getItem('schoolScores')\r\n          this.highestScore = localStorage.getItem('highestScore')\r\n          // just add it already\r\n          this.addScoreToDatabase()\r\n        }\r\n        // set to default state so repeating visits\r\n        // to this page won't fill our array with zeroes\r\n        store.state.gameInProgress = false // mutation?\r\n      } else {\r\n        console.log(`Nothing to record, play the game.`)\r\n      }\r\n    })\r\n  },\r\n  methods: {\r\n    restartGame () {\r\n      console.log(`Restarting game`)\r\n      store.commit('resetState')\r\n      this.$router.push('/game')\r\n    },\r\n    // add anonymous score to local storage\r\n    addScoreToDatabase () {\r\n      console.log(`Adding score`)\r\n      // one function?\r\n      if (this.lastScores === '') {\r\n        this.lastScores = [] // first run\r\n      } else {\r\n        this.lastScores = this.lastScores.split(',')\r\n      }\r\n      if (this.schoolScores === '') {\r\n        this.schoolScores = []\r\n      } else {\r\n        this.schoolScores = this.schoolScores.split(',')\r\n      }\r\n      // check for new highest score\r\n      if (this.getTotalScore > this.highestScore) {\r\n        this.highestScore = this.getTotalScore\r\n        localStorage.setItem('highestScore', this.getTotalScore)\r\n      } else {\r\n        console.log(`Your score is not so high: ${this.getTotalScore}`)\r\n      }\r\n\r\n      if (this.getCurrentGameState.schoolCompleted) {\r\n        // record game result if school completed\r\n        this.lastScores.push(this.getTotalScore)\r\n        localStorage.setItem('lastScoresArray', this.lastScores)\r\n        // and school result for stats\r\n        this.schoolScores.push(this.getSchoolScore)\r\n        localStorage.setItem('schoolScores', this.schoolScores)\r\n      } else {\r\n        // game ended in school,\r\n        // so we have only school result to save\r\n        this.schoolScores.push(this.getSchoolScore)\r\n        localStorage.setItem('schoolScores', this.schoolScores)\r\n      }\r\n      // finally if user is registered\r\n      if (this.getUserData.isAuthenticated) {\r\n        this.syncScoreInFirebase()\r\n      } else {\r\n        console.log(`Anonymous! To save results please register.`)\r\n      }\r\n    },\r\n    // if user exists add score to the account\r\n    syncScoreInFirebase () {\r\n      console.log(`Syncing score for uid ${this.getUserData.uid}`)\r\n      let uid = this.getUserData.uid\r\n      db.collection('users').where('uid', '==', uid)\r\n        .get()\r\n        .then(function (querySnapshot) {\r\n          let docToUpdateId\r\n          querySnapshot.forEach(function (doc) {\r\n            // doc.data() is never undefined for query doc snapshots\r\n            if (doc.data().uid === uid) {\r\n              docToUpdateId = doc.id\r\n            }\r\n          })\r\n          return docToUpdateId\r\n        })\r\n        .then((docToUpdateId) => {\r\n          var docRef = db.collection('users').doc(docToUpdateId)\r\n          let resultsArrayToUpdate = localStorage.getItem('lastScoresArray')\r\n          // you really should check if it is actually higher\r\n          let highestScoreToUpdate = localStorage.getItem('highestScore')\r\n          let schoolScoresToUpdate = localStorage.getItem('schoolScores')\r\n          var updateDocRef = docRef.update({\r\n            resultsArray: resultsArrayToUpdate,\r\n            schoolResultsArray: schoolScoresToUpdate,\r\n            hiScore: highestScoreToUpdate\r\n          })\r\n          console.log('...updating user stats')\r\n          return updateDocRef // ? true\r\n        })\r\n        .catch(function (error) {\r\n          console.log('Error getting documents: ', error)\r\n        })\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import \"../assets/scss/index.scss\";\r\n\r\n#endGame {\r\n  height: 100%;\r\n}\r\n.user-name-game-end, .message-school, .message-game {\r\n  font-family: $text-font;\r\n}\r\n.user-name-game-end {\r\n  span {\r\n    color: $color-chosen;\r\n  }\r\n}\r\n.message-school {\r\n  line-height: 1.5;\r\n}\r\n\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/EndGame.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',{attrs:{\"id\":\"endGame\"}},[_c('closeBtn'),_vm._v(\" \"),_c('v-layout',{attrs:{\"align-center\":\"\",\"justify-center\":\"\",\"row\":\"\",\"fill-height\":\"\",\"wrap\":\"\"}},[_c('v-flex',{staticClass:\"user-name-game-end text-xs-center\",attrs:{\"xs12\":\"\"}},[_c('h1',[_vm._v(_vm._s(_vm.message)),_c('br'),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.userName)+_vm._s(_vm.exclamation))])])]),_vm._v(\" \"),(!this.getCurrentGameState.schoolCompleted)?_c('v-flex',{staticClass:\"message-school text-xs-center\",attrs:{\"xs12\":\"\"}},[_c('h3',[_vm._v(_vm._s(_vm.graduationMessage))]),_vm._v(\" \"),_c('h2',[_vm._v(_vm._s(_vm.schoolScoreMessage)+\" \"+_vm._s(_vm.getTotalScore))])]):_vm._e(),_vm._v(\" \"),(this.getCurrentGameState.schoolCompleted)?_c('v-flex',{staticClass:\"message-game text-xs-center\",attrs:{\"xs12\":\"\"}},[_c('h2',[_vm._v(_vm._s(_vm.messageText)+\" \"+_vm._s(_vm.getTotalScore))])]):_vm._e(),_vm._v(\" \"),_c('v-layout',{attrs:{\"row\":\"\",\"align-center\":\"\",\"justify-space-around\":\"\"}},[_c('v-flex',{staticClass:\"text-xs-center\",attrs:{\"d-flex\":\"\",\"xs5\":\"\",\"lg2\":\"\"}},[_c('v-btn',{attrs:{\"ripple\":\"\",\"large\":\"\",\"color\":\"orange\"},on:{\"click\":_vm.restartGame}},[_c('v-icon',{attrs:{\"medium\":\"\",\"color\":\"white\"}},[_vm._v(\"replay\")])],1)],1),_vm._v(\" \"),_c('v-flex',{staticClass:\"text-xs-center\",attrs:{\"d-flex\":\"\",\"xs5\":\"\",\"lg2\":\"\"}},[_c('v-btn',{attrs:{\"ripple\":\"\",\"large\":\"\",\"color\":\"purple darken-1\",\"to\":'/settings'}},[_c('v-icon',{attrs:{\"medium\":\"\",\"color\":\"white\"}},[_vm._v(\"trending_up\")])],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2c9c3778\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/EndGame.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}